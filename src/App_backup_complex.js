// src/App.js

import { GoogleOAuthProvider, googleLogout, useGoogleLogin } from '@react-oauth/google';
import { useState, useEffect, useCallback, useRef } from 'react';
import axios from 'axios';
import CryptoJS from 'crypto-js';
import { marked } from 'marked';
import DOMPurify from 'dompurify';

// Ïó¨Í∏∞Ïóê GCPÏóêÏÑú Î∞úÍ∏âÎ∞õÏùÄ ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ IDÎ•º Î∂ôÏó¨ÎÑ£ÏúºÏÑ∏Ïöî.
const CLIENT_ID = process.env.REACT_APP_GOOGLE_CLIENT_ID;

// ÌôòÍ≤ΩÎ≥ÄÏàò Í≤ÄÏ¶ù Î∞è ÎîîÎ≤ÑÍ∑∏ Ï†ïÎ≥¥
console.log('Environment check:');
console.log('CLIENT_ID:', CLIENT_ID);
console.log('All env vars:', Object.keys(process.env).filter(key => key.startsWith('REACT_APP')));

if (!CLIENT_ID) {
  console.error('Google Client IDÍ∞Ä ÏÑ§Ï†ïÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§. .env ÌååÏùºÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.');
}

const SCOPES = 'https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/drive.appdata';
const SECRET_PREFIX = 'secret_';

// --- ÏïÑÏù¥ÏΩò Ïª¥Ìè¨ÎÑåÌä∏Îì§ ---
const SunIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>;
const MoonIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>;
const BookIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>;
const LogoutIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>;

// --- Ïú†Ìã∏Î¶¨Ìã∞ Ìï®ÏàòÎì§ ---
const saveToLocalStorage = (key, data) => {
  try {
    localStorage.setItem(`memo-app-${key}`, JSON.stringify(data));
    console.log(`üíæ Saved to localStorage: ${key}`, data);
  } catch (error) {
    console.error('‚ùå Failed to save to localStorage:', error);
  }
};

const loadFromLocalStorage = (key) => {
  try {
    const data = localStorage.getItem(`memo-app-${key}`);
    const parsed = data ? JSON.parse(data) : null;
    console.log(`üìÇ Loaded from localStorage: ${key}`, parsed);
    return parsed;
  } catch (error) {
    console.error('‚ùå Failed to load from localStorage:', error);
    return null;
  }
};

// --- UI Ïª¥Ìè¨ÎÑåÌä∏Îì§ ---
const Spinner = ({ themeStyles }) => {
  useEffect(() => {
    const styleSheet = document.createElement("style");
    styleSheet.type = "text/css";
    styleSheet.innerText = `@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }`;
    document.head.appendChild(styleSheet);
    return () => { document.head.removeChild(styleSheet); };
  }, []);
  return ( <div style={themeStyles.spinnerOverlay}><div style={themeStyles.spinner}></div></div> );
};

const Toast = ({ show, message, type, themeStyles }) => {
  if (!show) return null;
  const toastStyle = type === 'success' ? themeStyles.toastSuccess : themeStyles.toastError;
  return ( <div style={{ ...themeStyles.toast, ...toastStyle }}>{message}</div> );
};

const ConfirmModal = ({ show, message, onConfirm, onCancel, themeStyles }) => {
  if (!show) return null;
  return (
    <div style={themeStyles.modalOverlay}>
      <div style={themeStyles.modalContent}>
        <p style={{whiteSpace: 'pre-wrap'}}>{message}</p>
        <div style={themeStyles.modalActions}>
          <button style={{...themeStyles.button, ...themeStyles.modalButton}} onClick={onCancel}>Ï∑®ÏÜå</button>
          <button style={{...themeStyles.button, ...themeStyles.modalButton, ...themeStyles.dangerButton}} onClick={onConfirm}>ÌôïÏù∏</button>
        </div>
      </div>
    </div>
  );
};

// --- Ïª§Ïä§ÌÖÄ ÌõÖ ---
function useDebounce(value, delay) {
  const [debouncedValue, setDebouncedValue] = useState(value);
  useEffect(() => {
    const handler = setTimeout(() => { setDebouncedValue(value); }, delay);
    return () => { clearTimeout(handler); };
  }, [value, delay]);
  return debouncedValue;
}

// --- ÎèôÏ†Å Ïä§ÌÉÄÏùºÎßÅ ---
const getDynamicStyles = (theme = 'light') => {
    const colors = {
        light: { bg: '#f8f9fa', panelBg: '#ffffff', text: '#212529', textSecondary: '#6c757d', border: '#dee2e6', accent: '#007bff', accentText: '#ffffff', activeBg: '#e6f7ff', buttonBg: '#f1f3f5', buttonHoverBg: '#e9ecef', danger: '#dc3545', },
        dark: { bg: '#121212', panelBg: '#1e1e1e', text: '#e9ecef', textSecondary: '#adb5bd', border: '#495057', accent: '#0d6efd', accentText: '#ffffff', activeBg: '#032a58', buttonBg: '#343a40', buttonHoverBg: '#495057', danger: '#e03131', }
    };
    const c = colors[theme];
    return {
        container: { display: 'flex', height: '100vh', fontFamily: "-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif", backgroundColor: c.bg, color: c.text },
        loginContainer: { margin: 'auto', textAlign: 'center' },
        loginButton: { padding: '12px 20px', fontSize: '16px', cursor: 'pointer', backgroundColor: c.accent, color: c.accentText, border: 'none', borderRadius: '5px' },
        leftPanel: { width: '320px', borderRight: `1px solid ${c.border}`, display: 'flex', flexDirection: 'column', backgroundColor: c.panelBg, flexShrink: 0 },
        rightPanel: { flexGrow: 1, padding: '20px', display: 'flex', flexDirection: 'column' },
        header: { padding: '15px', borderBottom: `1px solid ${c.border}`, display: 'flex', alignItems: 'center', justifyContent: 'space-between', flexShrink: 0 },
        profileSection: { display: 'flex', alignItems: 'center', gap: '10px' },
        profileImage: { borderRadius: '50%', width: '32px', height: '32px' },
        iconButton: { background: 'none', border: 'none', color: c.textSecondary, cursor: 'pointer', padding: '5px' },
        section: { padding: '15px' },
        newNotebookForm: { display: 'flex', gap: '5px', marginTop: '10px' },
        input: { width: '100%', padding: '8px', boxSizing: 'border-box', border: `1px solid ${c.border}`, borderRadius: '5px', backgroundColor: c.bg, color: c.text, outline: 'none' },
        button: { padding: '10px', backgroundColor: c.accent, color: c.accentText, border: 'none', borderRadius: '5px', cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center' },
        notebookList: { listStyle: 'none', padding: 0, margin: '10px 0', overflowY: 'auto' },
        listItem: { padding: '10px 15px', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '10px', borderRadius: '5px' },
        activeListItem: { padding: '10px 15px', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '10px', borderRadius: '5px', backgroundColor: c.activeBg, fontWeight: 'bold' },
        memoList: { listStyle: 'none', padding: 0, margin: '10px 0 0 0', overflowY: 'auto' },
        memoListItem: { padding: '12px', borderTop: `1px solid ${c.border}`, cursor: 'pointer', display: 'flex', justifyContent: 'space-between', alignItems: 'center' },
        activeMemoListItem: { backgroundColor: c.activeBg },
        memoName: { whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis' },
        deleteButton: { background: 'none', border: 'none', color: c.textSecondary, cursor: 'pointer', fontSize: '16px', padding: '5px', opacity: 0.7, transition: 'opacity 0.2s' },
        placeholder: { display: 'flex', flexDirection: 'column', justifyContent: 'center', alignItems: 'center', height: '100%', color: c.textSecondary, textAlign: 'center' },
        editorContainer: { display: 'flex', flexGrow: 1, flexDirection: 'column', backgroundColor: c.panelBg, border: `1px solid ${c.border}`, borderRadius: '8px' },
        editorHeader: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '10px', borderBottom: `1px solid ${c.border}` },
        viewModeToggle: { display: 'flex', border: `1px solid ${c.border}`, borderRadius: '5px', overflow: 'hidden' },
        toggleButton: { background: c.panelBg, border: 'none', padding: '8px 15px', cursor: 'pointer', color: c.text },
        toggleButtonActive: { background: c.accent, border: 'none', padding: '8px 15px', cursor: 'pointer', color: c.accentText },
        editorPane: { flexGrow: 1, display: 'flex', flexDirection: 'column' },
        memoContentArea: { flexGrow: 1, border: 'none', padding: '15px', fontSize: '16px', fontFamily: 'monospace', resize: 'none', outline: 'none', backgroundColor: c.panelBg, color: c.text },
        previewContent: { flexGrow: 1, padding: '15px', overflowY: 'auto', lineHeight: 1.7, backgroundColor: c.panelBg },
        spinnerOverlay: { position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, backgroundColor: 'rgba(0, 0, 0, 0.5)', display: 'flex', justifyContent: 'center', alignItems: 'center', zIndex: 2000 },
        spinner: { border: '4px solid rgba(255, 255, 255, 0.3)', borderTop: '4px solid white', borderRadius: '50%', width: '40px', height: '40px', animation: 'spin 1s linear infinite' },
        toast: { position: 'fixed', bottom: '20px', left: '50%', transform: 'translateX(-50%)', padding: '12px 20px', borderRadius: '5px', color: 'white', zIndex: 1000 },
        toastSuccess: { backgroundColor: '#28a745' },
        toastError: { backgroundColor: '#dc3545' },
        modalOverlay: { position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, backgroundColor: 'rgba(0, 0, 0, 0.5)', display: 'flex', justifyContent: 'center', alignItems: 'center', zIndex: 1000 },
        modalContent: { backgroundColor: c.panelBg, padding: '20px 30px', borderRadius: '8px', textAlign: 'center', boxShadow: '0 4px 8px rgba(0,0,0,0.1)', maxWidth: '400px' },
        modalActions: { marginTop: '20px', display: 'flex', gap: '10px' },
        modalButton: { flex: 1, backgroundColor: c.buttonBg, color: c.text, border: `1px solid ${c.border}` },
        dangerButton: { backgroundColor: c.danger, color: c.accentText, border: 'none' },
    };
};

function MemoApp() {
  const [theme, setTheme] = useState(() => localStorage.getItem('memo-theme') || 'light');
  const styles = getDynamicStyles(theme);

  // üîß State Ï¥àÍ∏∞Ìôî - localStorageÏóêÏÑú Î∞îÎ°ú Î≥µÏõê
  const [notebooks, setNotebooks] = useState(() => loadFromLocalStorage('notebooks') || []);
  const [selectedNotebookId, setSelectedNotebookId] = useState(() => {
    const saved = loadFromLocalStorage('selectedNotebookId');
    return saved || 'all';
  });
  const [newNotebookName, setNewNotebookName] = useState('');
  
  const [user, setUser] = useState(null);
  const [accessToken, setAccessToken] = useState(() => {
    const token = localStorage.getItem('memo-app-access-token');
    const expiry = localStorage.getItem('memo-app-token-expiry');
    
    if (token && expiry) {
      const expiryTime = parseInt(expiry);
      const now = Date.now();
      
      // ÌÜ†ÌÅ∞Ïù¥ ÏïÑÏßÅ Ïú†Ìö®ÌïúÏßÄ ÌôïÏù∏ (10Î∂Ñ Ïó¨Ïú†)
      if (now < expiryTime - 10 * 60 * 1000) {
        console.log('üîß Ïï± ÏãúÏûë Ïãú ÌÜ†ÌÅ∞ Î≥µÏõê');
        return token;
      } else {
        console.log('‚è∞ Ï†ÄÏû•Îêú ÌÜ†ÌÅ∞ ÎßåÎ£å, ÏÇ≠Ï†ú');
        localStorage.removeItem('memo-app-access-token');
        localStorage.removeItem('memo-app-token-expiry');
      }
    }
    return null;
  });
  
  const [memos, setMemos] = useState(() => {
    const savedNotebookId = loadFromLocalStorage('selectedNotebookId') || 'all';
    return loadFromLocalStorage(`memos-${savedNotebookId}`) || [];
  });
  
  const [newMemoContent, setNewMemoContent] = useState('');
  const [isNewMemoSecret, setIsNewMemoSecret] = useState(false);
  const [newMemoPassword, setNewMemoPassword] = useState('');

  const [isLoading, setIsLoading] = useState(false);
  const [selectedMemo, setSelectedMemo] = useState(null);
  const [searchTerm, setSearchTerm] = useState('');
  const debouncedSearchTerm = useDebounce(searchTerm, 300);
  const [viewMode, setViewMode] = useState('edit');

  const [toast, setToast] = useState({ show: false, message: '', type: 'success' });
  const [modal, setModal] = useState({ show: false, message: '', onConfirm: () => {} });

  console.log('üöÄ Ïï± ÏÉÅÌÉú:', {
    accessToken: accessToken ? accessToken.substring(0, 20) + '...' : null,
    notebooks: notebooks.length,
    memos: memos.length,
    selectedNotebookId
  });

  const showToast = useCallback((message, type = 'success', duration = 3000) => {
    setToast({ show: true, message, type });
    setTimeout(() => { setToast({ show: false, message: '', type: 'success' }); }, duration);
  }, []);

  const login = useGoogleLogin({
    onSuccess: async (tokenResponse) => {
      console.log('üéâ Login successful:', tokenResponse);
      const token = tokenResponse.access_token;
      
      // üîß ÌÜ†ÌÅ∞ÏùÑ localStorageÏóê Ï†ÄÏû•
      localStorage.setItem('memo-app-access-token', token);
      
      // ÌÜ†ÌÅ∞ ÎßåÎ£å ÏãúÍ∞ÑÎèÑ Ï†ÄÏû• (1ÏãúÍ∞Ñ ÌõÑ)
      const expiryTime = Date.now() + (tokenResponse.expires_in || 3600) * 1000;
      localStorage.setItem('memo-app-token-expiry', expiryTime.toString());
      
      // ÌÜ†ÌÅ∞ ÏÑ§Ï†ï (React state)
      setAccessToken(token);
      
      console.log('‚è∞ ÌÜ†ÌÅ∞ ÏÑ§Ï†ï ÏôÑÎ£å, 3Ï¥à ÌõÑ Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏãúÏûë...');
      showToast('Î°úÍ∑∏Ïù∏ ÏÑ±Í≥µ! Ïû†Ïãú ÌõÑ Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨ÏòµÎãàÎã§...', 'success');
      
      // üîß Îçî Í∏¥ ÏßÄÏó∞Í≥º Ïû¨ÏãúÎèÑ Î°úÏßÅ
      const attemptDataLoad = async (attempt = 1, maxAttempts = 3) => {
        try {
          setIsLoading(true);
          console.log(`üöÄ Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏãúÎèÑ ${attempt}/${maxAttempts}`);
          
          // ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞
          const userResponse = await axios.get('https://www.googleapis.com/oauth2/v3/userinfo', {
            headers: { 'Authorization': `Bearer ${token}` }
          });
          console.log('‚úÖ ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Î°úÎìú ÏÑ±Í≥µ:', userResponse.data.name);
          setUser(userResponse.data);
          
          // Google DriveÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Î°úÎìú
          await loadDataFromDrive(token);
          
          console.log('üéâ Î°úÍ∑∏Ïù∏ ÌõÑ Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏÑ±Í≥µ!');
          
        } catch (error) {
          console.error(`‚ùå Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏãúÎèÑ ${attempt} Ïã§Ìå®:`, error);
          
          if (attempt < maxAttempts) {
            const delay = attempt * 2000; // 2Ï¥à, 4Ï¥à ÏàúÏúºÎ°ú Ï¶ùÍ∞Ä
            console.log(`‚è∞ ${delay/1000}Ï¥à ÌõÑ Ïû¨ÏãúÎèÑ...`);
            showToast(`Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®, ${delay/1000}Ï¥à ÌõÑ Ïû¨ÏãúÎèÑ... (${attempt}/${maxAttempts})`, 'error');
            
            setTimeout(() => {
              attemptDataLoad(attempt + 1, maxAttempts);
            }, delay);
          } else {
            console.error('‚ùå Î™®Îì† Ïû¨ÏãúÎèÑ Ïã§Ìå®');
            showToast('Îç∞Ïù¥ÌÑ∞ Î°úÎìúÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. üîÑ ÏÉàÎ°úÍ≥†Ïπ® Î≤ÑÌäºÏùÑ ÎàåÎü¨Ï£ºÏÑ∏Ïöî.', 'error');
            setIsLoading(false);
          }
        }
      };
      
      // 3Ï¥à ÌõÑ Ï≤´ Î≤àÏß∏ ÏãúÎèÑ
      setTimeout(() => {
        attemptDataLoad();
      }, 3000);
    },
    onError: (errorResponse) => {
      console.error('Login Failed:', errorResponse);
      showToast('Î°úÍ∑∏Ïù∏Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. Google Cloud Console ÏÑ§Ï†ïÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.', 'error');
    },
    scope: SCOPES,
  });
  
  const handleLogout = () => {
    googleLogout(); 
    setUser(null); 
    setAccessToken(null); 
    setNotebooks([]); 
    setMemos([]);
    setSelectedMemo(null); 
    setSelectedNotebookId('all');
    
    // üîß localStorageÏóêÏÑú ÌÜ†ÌÅ∞ Ï†ïÎ≥¥ ÏÇ≠Ï†ú
    localStorage.removeItem('memo-app-access-token');
    localStorage.removeItem('memo-app-token-expiry');
  };

  const toggleTheme = () => {
    const newTheme = theme === 'light' ? 'dark' : 'light';
    setTheme(newTheme);
    localStorage.setItem('memo-theme', newTheme);
  };

  // üîß Google DriveÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Î°úÎìúÌïòÎäî Ìï®Ïàò
  const loadDataFromDrive = async (token) => {
    try {
      console.log('üìÅ Google DriveÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏãúÏûë...');
      console.log('üîë ÏÇ¨Ïö© Ï§ëÏù∏ ÌÜ†ÌÅ∞:', token.substring(0, 20) + '...');
      
      // Î®ºÏ†Ä Í∞ÑÎã®Ìïú ÌÖåÏä§Ìä∏ Ìò∏Ï∂úÎ°ú ÌÜ†ÌÅ∞ Ïú†Ìö®ÏÑ± ÌôïÏù∏
      console.log('üîç ÌÜ†ÌÅ∞ Ïú†Ìö®ÏÑ± ÌÖåÏä§Ìä∏ Ï§ë...');
      const testResponse = await axios.get('https://www.googleapis.com/oauth2/v3/userinfo', {
        headers: { 'Authorization': `Bearer ${token}` }
      });
      console.log('‚úÖ ÌÜ†ÌÅ∞ Ïú†Ìö®ÏÑ± ÌôïÏù∏ ÏôÑÎ£å:', testResponse.data.email);
      
      // Drive API Í∏∞Î≥∏ Í∂åÌïú ÌÖåÏä§Ìä∏
      console.log('üîç Drive API Í∂åÌïú ÌÖåÏä§Ìä∏ Ï§ë...');
      const aboutResponse = await axios.get('https://www.googleapis.com/drive/v3/about?fields=user', {
        headers: { 'Authorization': `Bearer ${token}` }
      });
      console.log('‚úÖ Drive API Ï†ëÍ∑º Í∞ÄÎä•:', aboutResponse.data.user.emailAddress);
      
      // ÎÖ∏Ìä∏Î∂Å(Ìè¥Îçî) Í∞ÄÏ†∏Ïò§Í∏∞
      console.log('üîç ÎÖ∏Ìä∏Î∂Å Í≤ÄÏÉâ Ï§ë...');
      const notebooksResponse = await axios.get('https://www.googleapis.com/drive/v3/files', {
        headers: { 'Authorization': `Bearer ${token}` },
        params: {
          q: "mimeType='application/vnd.google-apps.folder' and trashed=false",
          fields: 'files(id, name, mimeType, parents)',
          pageSize: 100
        }
      });
      
      const driveNotebooks = notebooksResponse.data.files || [];
      console.log(`‚úÖ ÎÖ∏Ìä∏Î∂Å ${driveNotebooks.length}Í∞ú Î∞úÍ≤¨:`, driveNotebooks);
      
      if (driveNotebooks.length > 0) {
        console.log('üìÅ ÎÖ∏Ìä∏Î∂Å ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ Ï§ë...');
        setNotebooks(driveNotebooks);
        saveToLocalStorage('notebooks', driveNotebooks);
        setSelectedNotebookId(driveNotebooks[0].id);
        console.log('‚úÖ ÎÖ∏Ìä∏Î∂Å ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å');
      } else {
        console.log('üìÅ ÎÖ∏Ìä∏Î∂ÅÏù¥ ÏóÜÏùå, "Î™®Îì† Î©îÎ™®"Î°ú ÏÑ§Ï†ï');
        setSelectedNotebookId('all');
      }
      
      // Î©îÎ™®(ÌÖçÏä§Ìä∏ ÌååÏùº) Í∞ÄÏ†∏Ïò§Í∏∞
      console.log('üîç Î©îÎ™® Í≤ÄÏÉâ Ï§ë...');
      const memosResponse = await axios.get('https://www.googleapis.com/drive/v3/files', {
        headers: { 'Authorization': `Bearer ${token}` },
        params: {
          q: "(mimeType='text/plain' or name contains '.txt') and trashed=false",
          fields: 'files(id, name, mimeType, parents, createdTime)',
          orderBy: 'createdTime desc',
          pageSize: 200
        }
      });
      
      const driveMemos = memosResponse.data.files || [];
      console.log(`‚úÖ Î©îÎ™® ${driveMemos.length}Í∞ú Î∞úÍ≤¨:`, driveMemos);
      
      if (driveMemos.length > 0) {
        console.log('üìù Î©îÎ™® ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ Ï§ë...');
        setMemos(driveMemos);
        saveToLocalStorage('memos-all', driveMemos);
        saveToLocalStorage(`memos-${selectedNotebookId || 'all'}`, driveMemos);
        console.log('‚úÖ Î©îÎ™® ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å');
      } else {
        console.log('üìù Î©îÎ™®Í∞Ä ÏóÜÏùå');
        setMemos([]);
      }
      
      console.log('üéâ Drive Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏôÑÎ£å!');
      showToast(`ÎÖ∏Ìä∏Î∂Å ${driveNotebooks.length}Í∞ú, Î©îÎ™® ${driveMemos.length}Í∞úÎ•º Î∂àÎü¨ÏôîÏäµÎãàÎã§!`, 'success');
      
    } catch (error) {
      console.error('‚ùå Drive Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®:', error);
      console.error('‚ùå Ïò§Î•ò ÏÉÅÏÑ∏:', {
        message: error.message,
        status: error.response?.status,
        statusText: error.response?.statusText,
        data: error.response?.data
      });
      
      // Ïã§Ìå®Ìïú Í≤ΩÏö∞ Ï∫êÏãúÎêú Îç∞Ïù¥ÌÑ∞ÎùºÎèÑ Î≥¥Ïó¨Ï£ºÍ∏∞
      const cachedNotebooks = loadFromLocalStorage('notebooks');
      const cachedMemos = loadFromLocalStorage('memos-all');
      
      if (cachedNotebooks) {
        setNotebooks(cachedNotebooks);
        console.log(`üìÇ Ï∫êÏãúÎêú ÎÖ∏Ìä∏Î∂Å ${cachedNotebooks.length}Í∞ú Î≥µÏõê`);
      }
      
      if (cachedMemos) {
        setMemos(cachedMemos);
        console.log(`üìù Ï∫êÏãúÎêú Î©îÎ™® ${cachedMemos.length}Í∞ú Î≥µÏõê`);
      }
      
      if (error.response?.status === 403) {
        showToast('Google Drive Í∂åÌïúÏù¥ ÌïÑÏöîÌï©ÎãàÎã§. OAuth ÏÑ§Ï†ïÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.', 'error');
      } else if (error.response?.status === 401) {
        showToast('ÌÜ†ÌÅ∞Ïù¥ ÎßåÎ£åÎêòÏóàÏäµÎãàÎã§. Îã§Ïãú Î°úÍ∑∏Ïù∏Ìï¥Ï£ºÏÑ∏Ïöî.', 'error');
      } else {
        showToast(`Drive Ïó∞Í≤∞ Ïã§Ìå®: ${error.message}`, 'error');
      }
      
      throw error; // ÏÉÅÏúÑÏóêÏÑú ÏóêÎü¨Î•º Ï≤òÎ¶¨Ìï† Ïàò ÏûàÎèÑÎ°ù
    } finally {
      setIsLoading(false); // üîß ÏÑ±Í≥µ/Ïã§Ìå® Í¥ÄÍ≥ÑÏóÜÏù¥ Î°úÎî© ÏÉÅÌÉú Ìï¥Ï†ú
    }
  };

  // üîß ÌÜ†ÌÅ∞Ïù¥ ÏûàÏúºÎ©¥ ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í≥† Îç∞Ïù¥ÌÑ∞ Î°úÎìú
  useEffect(() => {
    if (accessToken && !user) {
      console.log('üîß ÌÜ†ÌÅ∞ Î≥µÏõê ÌõÑ Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ï§ë...');
      
      const initializeData = async () => {
        try {
          setIsLoading(true);
          
          // ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞
          const response = await axios.get('https://www.googleapis.com/oauth2/v3/userinfo', {
            headers: { 'Authorization': `Bearer ${accessToken}` }
          });
          console.log('‚úÖ ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞ ÏÑ±Í≥µ');
          setUser(response.data);
          
          // Drive Îç∞Ïù¥ÌÑ∞ Î°úÎìú
          await loadDataFromDrive(accessToken);
          
        } catch (error) {
          console.error('‚ùå ÌÜ†ÌÅ∞ Î≥µÏõê ÌõÑ Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®:', error);
          if (error.response?.status === 401) {
            // ÌÜ†ÌÅ∞Ïù¥ ÎßåÎ£åÎêú Í≤ΩÏö∞
            console.log('üîê ÌÜ†ÌÅ∞ ÎßåÎ£å, ÏÇ≠Ï†úÌï©ÎãàÎã§');
            localStorage.removeItem('memo-app-access-token');
            localStorage.removeItem('memo-app-token-expiry');
            setAccessToken(null);
          } else {
            // Îã§Î•∏ Ïò§Î•òÏùò Í≤ΩÏö∞ Ï∫êÏãúÎêú Îç∞Ïù¥ÌÑ∞ ÌëúÏãú
            const cachedNotebooks = loadFromLocalStorage('notebooks');
            const cachedMemos = loadFromLocalStorage('memos-all');
            
            if (cachedNotebooks) setNotebooks(cachedNotebooks);
            if (cachedMemos) setMemos(cachedMemos);
            
            showToast('Ïò®ÎùºÏù∏ Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®. Ï∫êÏãúÎêú Îç∞Ïù¥ÌÑ∞Î•º ÌëúÏãúÌï©ÎãàÎã§.', 'error');
          }
        } finally {
          setIsLoading(false);
        }
      };
      
      initializeData();
    }
  }, [accessToken, user]);

  // üîß selectedNotebookId Î≥ÄÍ≤ΩÏÇ¨Ìï≠ Ï†ÄÏû• Î∞è Î©îÎ™® ÌïÑÌÑ∞ÎßÅ
  useEffect(() => {
    if (selectedNotebookId) {
      saveToLocalStorage('selectedNotebookId', selectedNotebookId);
      
      // ÏÑ†ÌÉùÎêú ÎÖ∏Ìä∏Î∂ÅÏóê Îî∞Îùº Î©îÎ™® ÌïÑÌÑ∞ÎßÅ
      const allMemos = loadFromLocalStorage('memos-all') || [];
      
      if (selectedNotebookId === 'all') {
        // Î™®Îì† Î©îÎ™® ÌëúÏãú
        setMemos(allMemos);
        console.log(`üìÅ "Î™®Îì† Î©îÎ™®" ÏÑ†ÌÉùÎê®, Î©îÎ™® ${allMemos.length}Í∞ú ÌëúÏãú`);
      } else {
        // ÌäπÏ†ï ÎÖ∏Ìä∏Î∂ÅÏùò Î©îÎ™®Îßå ÌëúÏãú
        const notebookMemos = allMemos.filter(memo => 
          memo.parents && memo.parents.includes(selectedNotebookId)
        );
        setMemos(notebookMemos);
        console.log(`üìÅ ÎÖ∏Ìä∏Î∂Å "${selectedNotebookId}" ÏÑ†ÌÉùÎê®, Î©îÎ™® ${notebookMemos.length}Í∞ú ÌëúÏãú`);
      }
    }
  }, [selectedNotebookId]);

  const createMemo = async () => {
    if (!accessToken || !newMemoContent.trim() || (isNewMemoSecret && !newMemoPassword.trim())) {
      if (isNewMemoSecret && !newMemoPassword.trim()) showToast('ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.', 'error');
      return;
    }
    
    // "Î™®Îì† Î©îÎ™®"Í∞Ä ÏÑ†ÌÉùÎêú Í≤ΩÏö∞ appDataFolderÏóê ÏßÅÏ†ë Ï†ÄÏû•
    let targetParent = selectedNotebookId;
    if (selectedNotebookId === 'all' || !selectedNotebookId) {
        targetParent = 'appDataFolder';
    }
    
    setIsLoading(true);
    let contentToSave = newMemoContent;
    let fileNamePrefix = '';
    if (isNewMemoSecret) {
      contentToSave = CryptoJS.AES.encrypt(newMemoContent, newMemoPassword).toString();
      fileNamePrefix = SECRET_PREFIX;
    }
    const firstLine = newMemoContent.split('\n')[0].slice(0, 30).trim();
    const safeFileName = firstLine.replace(/[\\/:*?"<>|]/g, "") + ".txt";
    const fileName = fileNamePrefix + (firstLine ? safeFileName : `memo-${Date.now()}.txt`);
    const metadata = { name: fileName, mimeType: 'text/plain', parents: [targetParent] };
    
    console.log('üìù Creating memo:', {
      fileName,
      targetParent,
      selectedNotebookId,
      metadata,
      contentLength: contentToSave.length
    });
    
    const boundary = '-------314159265358979323846';
    const delimiter = `\r\n--${boundary}\r\n`;
    const close_delim = `\r\n--${boundary}--`;
    let multipartRequestBody = delimiter + 'Content-Type: application/json; charset=UTF-8\r\n\r\n' + JSON.stringify(metadata) + delimiter + 'Content-Type: text/plain; charset=UTF-8\r\n\r\n' + contentToSave + close_delim;
    try {
      const res = await axios.post('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', multipartRequestBody, { headers: { 'Authorization': `Bearer ${accessToken}`, 'Content-Type': `multipart/related; boundary=${boundary}` } });
      
      console.log('‚úÖ Memo created successfully:', res.data);
      
      // Ï†ÄÏû•Îêú Î©îÎ™®Î•º Ï¶âÏãú Î™©Î°ùÏóê Ï∂îÍ∞Ä
      const newMemo = {
        id: res.data.id,
        name: fileName,
        mimeType: 'text/plain',
        parents: [targetParent],
        createdTime: new Date().toISOString()
      };
      
      // Ï†ÑÏ≤¥ Î©îÎ™® Î™©Î°ù ÏóÖÎç∞Ïù¥Ìä∏
      const currentAllMemos = loadFromLocalStorage('memos-all') || [];
      const updatedAllMemos = [newMemo, ...currentAllMemos];
      saveToLocalStorage('memos-all', updatedAllMemos);
      
      // ÌòÑÏû¨ ÏÑ†ÌÉùÎêú ÎÖ∏Ìä∏Î∂ÅÏóê ÎßûÍ≤å ÌëúÏãúÌï† Î©îÎ™® Í≤∞Ï†ï
      if (selectedNotebookId === 'all' || selectedNotebookId === targetParent) {
        setMemos(prevMemos => {
          const updatedMemos = [newMemo, ...prevMemos];
          return updatedMemos;
        });
      }
      
      console.log('‚úÖ ÏÉà Î©îÎ™®Í∞Ä Î™©Î°ùÏóê Ï∂îÍ∞ÄÎê®:', fileName);
      
      showToast('Î©îÎ™®Í∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.', 'success');
      setNewMemoContent('');
      setIsNewMemoSecret(false);
      setNewMemoPassword('');
      
    } catch (error) { 
      console.error('‚ùå Error creating memo:', error); 
      showToast('Î©îÎ™® Ï†ÄÏû•Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.', 'error'); 
    } 
    finally { setIsLoading(false); }
  };

  const getMemoContent = async (fileId, fileName) => {
    setViewMode('edit');
    if (!accessToken) return;
    if (fileName.startsWith(SECRET_PREFIX)) {
      const password = window.prompt("ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî:");
      if (!password) return;
      setIsLoading(true);
      setSelectedMemo(null);
      try {
        const res = await axios.get(`https://www.googleapis.com/drive/v3/files/${fileId}?alt=media`, { headers: { 'Authorization': `Bearer ${accessToken}` } });
        const decryptedBytes = CryptoJS.AES.decrypt(res.data, password);
        const decryptedContent = decryptedBytes.toString(CryptoJS.enc.Utf8);
        if (!decryptedContent) {
          showToast('ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÌãÄÎ†∏ÏäµÎãàÎã§.', 'error');
          return;
        }
        setSelectedMemo({ id: fileId, name: fileName, content: decryptedContent, isSecret: true, password });
      } catch (error) { console.error('Error decrypting memo:', error); showToast('ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÌãÄÎ†∏Í±∞ÎÇò ÌååÏùºÏù¥ ÏÜêÏÉÅÎêòÏóàÏäµÎãàÎã§.', 'error'); } 
      finally { setIsLoading(false); }
    } else {
      setIsLoading(true);
      setSelectedMemo(null);
      try {
        const res = await axios.get(`https://www.googleapis.com/drive/v3/files/${fileId}?alt=media`, { headers: { 'Authorization': `Bearer ${accessToken}` } });
        setSelectedMemo({ id: fileId, name: fileName, content: res.data });
      } catch (error) { console.error('Error getting memo content:', error); showToast('Î©îÎ™®Î•º Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.', 'error'); } 
      finally { setIsLoading(false); }
    }
  };

  const updateMemo = async () => {
    if (!accessToken || !selectedMemo) return;
    setIsLoading(true);
    let contentToSave = selectedMemo.content;
    if (selectedMemo.isSecret) {
      contentToSave = CryptoJS.AES.encrypt(selectedMemo.content, selectedMemo.password).toString();
    }
    const boundary = '-------314159265358979323846';
    const delimiter = `\r\n--${boundary}\r\n`;
    const close_delim = `\r\n--${boundary}--`;
    let multipartRequestBody = delimiter + 'Content-Type: application/json; charset=UTF-8\r\n\r\n' + '{}' + delimiter + 'Content-Type: text/plain; charset=UTF-8\r\n\r\n' + contentToSave + close_delim;
    try {
      await axios.patch(`https://www.googleapis.com/upload/drive/v3/files/${selectedMemo.id}?uploadType=multipart`, multipartRequestBody, { headers: { 'Authorization': `Bearer ${accessToken}`, 'Content-Type': `multipart/related; boundary=${boundary}` } });
      showToast('Î©îÎ™®Í∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÏóÖÎç∞Ïù¥Ìä∏ÎêòÏóàÏäµÎãàÎã§.', 'success');
    } catch (error) { console.error('Error updating memo:', error); showToast('Î©îÎ™® ÏóÖÎç∞Ïù¥Ìä∏Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.', 'error'); } 
    finally { setIsLoading(false); }
  };

  const deleteMemo = (memoId) => {
    if (!accessToken) return;
    const confirmDelete = async () => {
      setIsLoading(true);
      try {
        await axios.delete(`https://www.googleapis.com/drive/v3/files/${memoId}`, { headers: { 'Authorization': `Bearer ${accessToken}` } });
        
        // Î°úÏª¨ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
        setMemos(prevMemos => {
          const updatedMemos = prevMemos.filter(memo => memo.id !== memoId);
          saveToLocalStorage(`memos-${selectedNotebookId}`, updatedMemos);
          return updatedMemos;
        });
        
        if (selectedMemo?.id === memoId) {
          setSelectedMemo(null);
        }
        showToast('Î©îÎ™®Í∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.', 'success');
      } catch (error) { console.error('Error deleting memo:', error); showToast('Î©îÎ™® ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.', 'error'); } 
      finally { setIsLoading(false); setModal({ show: false, message: '', onConfirm: () => {} }); }
    };
    setModal({ show: true, message: 'Ïù¥ Î©îÎ™®Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?', onConfirm: confirmDelete });
  };

  const filteredMemos = memos.filter(memo => memo.name.toLowerCase().includes(debouncedSearchTerm.toLowerCase()));
  
  return (
    <div style={styles.container}>
      {isLoading && <Spinner themeStyles={styles} />}
      <Toast show={toast.show} message={toast.message} type={toast.type} themeStyles={styles} />
      <ConfirmModal show={modal.show} message={modal.message} onConfirm={modal.onConfirm} onCancel={() => setModal({ show: false, message: '', onConfirm: () => {} })} themeStyles={styles} />
      
      {!accessToken ? (
        <div style={styles.loginContainer}>
          <h1>Î©îÎ™®Ïû• Ïï±</h1>
          <p>Google DriveÏôÄ Ïó∞ÎèôÌïòÏó¨ Î©îÎ™®Î•º ÏïàÏ†ÑÌïòÍ≤å Ï†ÄÏû•ÌïòÏÑ∏Ïöî.</p>
          <button style={styles.loginButton} onClick={login}>GoogleÎ°ú Î°úÍ∑∏Ïù∏</button>
        </div>
      ) : (
        <>
          <div style={styles.leftPanel}>
            <div style={styles.header}>
              <div style={styles.profileSection}>
                {user?.picture && <img src={user.picture} alt="Profile" style={styles.profileImage} />}
                <span>{user?.name || 'User'}</span>
              </div>
              <div style={{display: 'flex', gap: '5px'}}>
                <button style={styles.iconButton} onClick={toggleTheme} title="ÌÖåÎßà Î≥ÄÍ≤Ω">
                  {theme === 'light' ? <MoonIcon /> : <SunIcon />}
                </button>
                <button style={styles.iconButton} onClick={handleLogout} title="Î°úÍ∑∏ÏïÑÏõÉ">
                  <LogoutIcon />
                </button>
              </div>
            </div>
            
            <div style={styles.section}>
              <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '10px'}}>
                <h3>üìÅ ÎÖ∏Ìä∏Î∂Å</h3>
                {accessToken && (
                  <button 
                    style={{
                      ...styles.iconButton, 
                      fontSize: '12px', 
                      border: `1px solid ${styles.border}`,
                      borderRadius: '3px',
                      padding: '4px 8px'
                    }} 
                    onClick={() => loadDataFromDrive(accessToken)}
                    title="Google DriveÏóêÏÑú Îç∞Ïù¥ÌÑ∞ ÏÉàÎ°úÍ≥†Ïπ®"
                  >
                    üîÑ
                  </button>
                )}
              </div>
              <ul style={styles.notebookList}>
                <li style={selectedNotebookId === 'all' ? styles.activeListItem : styles.listItem} onClick={() => setSelectedNotebookId('all')}>
                  üìã Î™®Îì† Î©îÎ™®
                </li>
                {notebooks.map(notebook => (
                  <li key={notebook.id} style={selectedNotebookId === notebook.id ? styles.activeListItem : styles.listItem} onClick={() => setSelectedNotebookId(notebook.id)}>
                    <BookIcon /> {notebook.name}
                  </li>
                ))}
              </ul>
            </div>
            
            <div style={{...styles.section, flexGrow: 1, display: 'flex', flexDirection: 'column'}}>
              <h3>üìù Î©îÎ™®</h3>
              <input type="text" placeholder="Î©îÎ™® Í≤ÄÏÉâ..." value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} style={{...styles.input, marginBottom: '10px'}} />
              
              <div style={{marginBottom: '10px'}}>
                <textarea placeholder="ÏÉà Î©îÎ™®Î•º ÏûëÏÑ±ÌïòÏÑ∏Ïöî..." value={newMemoContent} onChange={(e) => setNewMemoContent(e.target.value)} style={{...styles.input, height: '80px', resize: 'vertical'}}></textarea>
                <div style={{display: 'flex', alignItems: 'center', gap: '10px', marginTop: '5px'}}>
                  <label style={{display: 'flex', alignItems: 'center', gap: '5px', fontSize: '14px'}}>
                    <input type="checkbox" checked={isNewMemoSecret} onChange={(e) => setIsNewMemoSecret(e.target.checked)} />
                    üîí ÎπÑÎ∞Ä Î©îÎ™®
                  </label>
                  {isNewMemoSecret && <input type="password" placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏" value={newMemoPassword} onChange={(e) => setNewMemoPassword(e.target.value)} style={{...styles.input, flex: 1}} />}
                  <button onClick={createMemo} style={{...styles.button, flexShrink: 0}}>Ï†ÄÏû•</button>
                </div>
              </div>
              
              <ul style={styles.memoList}>
                {filteredMemos.map(memo => (
                    <li key={memo.id} onClick={() => getMemoContent(memo.id, memo.name)} style={{ ...styles.memoListItem, ...(selectedMemo?.id === memo.id ? styles.activeMemoListItem : {}) }}>
                        <div style={styles.memoName}>
                          {memo.name.startsWith(SECRET_PREFIX) ? 'üîí ' : ''}
                          {memo.name.replace('.txt', '').replace(SECRET_PREFIX, '')}
                          <div style={{fontSize: '12px', color: styles.textSecondary, marginTop: '2px'}}>
                            {memo.createdTime ? new Date(memo.createdTime).toLocaleDateString('ko-KR') : 'ÎÇ†Ïßú ÏóÜÏùå'}
                          </div>
                        </div>
                        <button 
                          style={styles.deleteButton} 
                          onClick={(e) => { 
                            e.stopPropagation(); 
                            deleteMemo(memo.id); 
                          }}
                          title="Î©îÎ™® ÏÇ≠Ï†ú"
                        >üóëÔ∏è</button>
                    </li>
                ))}
              </ul>
            </div>
          </div>
          <div style={styles.rightPanel}>
            {selectedMemo ? (
              <div style={styles.editorContainer}>
                <div style={styles.editorHeader}>
                  <div style={styles.viewModeToggle}>
                    <button style={viewMode === 'edit' ? styles.toggleButtonActive : styles.toggleButton} onClick={() => setViewMode('edit')}>Ìé∏Ïßë</button>
                    <button style={viewMode === 'preview' ? styles.toggleButtonActive : styles.toggleButton} onClick={() => setViewMode('preview')}>ÎØ∏Î¶¨Î≥¥Í∏∞</button>
                  </div>
                  <button style={{...styles.button, width: 'auto', padding: '8px 15px'}} onClick={updateMemo}>{isLoading ? 'Ï†ÄÏû• Ï§ë...' : 'Î≥ÄÍ≤ΩÏÇ¨Ìï≠ Ï†ÄÏû•'}</button>
                </div>
                <div style={styles.editorPane}>
                  {viewMode === 'edit' ? (
                    <textarea style={styles.memoContentArea} value={selectedMemo.content} onChange={(e) => setSelectedMemo({ ...selectedMemo, content: e.target.value })} />
                  ) : (
                    <div style={styles.previewContent} dangerouslySetInnerHTML={{ __html: DOMPurify.sanitize(marked.parse(selectedMemo.content || '')) }}></div>
                  )}
                </div>
              </div>
            ) : ( 
              <div style={styles.placeholder}>
                <h2>‚úÖ Î©îÎ™®Ïû• Ïï±Ïù¥ Ï§ÄÎπÑÎêòÏóàÏäµÎãàÎã§!</h2>
                <p>‚Üê ÏôºÏ™ΩÏóêÏÑú Î©îÎ™®Î•º ÏÑ†ÌÉùÌïòÍ±∞ÎÇò ÏÉàÎ°ú ÏûëÏÑ±Ìï¥Î≥¥ÏÑ∏Ïöî.</p>
                <div style={{marginTop: '20px', textAlign: 'left'}}>
                  <h4>üîß Îç∞Ïù¥ÌÑ∞ ÏßÄÏÜçÏÑ± Ìï¥Í≤∞Îê®!</h4>
                  <p>‚úÖ ÏÉàÎ°úÍ≥†Ïπ®Ìï¥ÎèÑ Î©îÎ™®Í∞Ä ÏÇ¨ÎùºÏßÄÏßÄ ÏïäÏäµÎãàÎã§</p>
                  <p>‚úÖ Î°úÍ∑∏Ïù∏ ÏÉÅÌÉúÍ∞Ä Ïú†ÏßÄÎê©ÎãàÎã§</p>
                  <p>‚úÖ ÏÑ†ÌÉùÌïú ÎÖ∏Ìä∏Î∂ÅÏù¥ Í∏∞ÏñµÎê©ÎãàÎã§</p>
                  
                  <h4>üìä ÌòÑÏû¨ ÏÉÅÌÉú:</h4>
                  <p>üìÅ ÎÖ∏Ìä∏Î∂Å: {notebooks.length}Í∞ú</p>
                  <p>üìù Î©îÎ™®: {memos.length}Í∞ú</p>
                  <p>üîê Î°úÍ∑∏Ïù∏: {user?.name || 'ÏôÑÎ£å'}</p>
                </div>
              </div> 
            )}
          </div>
        </>
      )}
    </div>
  );
}

function App() {
  return ( <GoogleOAuthProvider clientId={CLIENT_ID}><MemoApp /></GoogleOAuthProvider> );
}

export default App;
